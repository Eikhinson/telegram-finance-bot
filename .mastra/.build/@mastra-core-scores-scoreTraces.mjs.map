{"version":3,"file":"@mastra-core-scores-scoreTraces.mjs","sources":["../../node_modules/@mastra/core/dist/scores/scoreTraces/index.js"],"sourcesContent":["import { createStep, createWorkflow } from '../../chunk-2BY7C6Y7.js';\nimport { saveScorePayloadSchema } from '../../chunk-RLYWCJQ6.js';\nimport { convertMessages } from '../../chunk-GIK7MM2K.js';\nimport { MastraError } from '../../chunk-PZUZNPFM.js';\nimport pMap from 'p-map';\nimport z from 'zod';\n\n// src/scores/scoreTraces/scoreTraces.ts\nasync function scoreTraces({\n  scorerName,\n  targets,\n  mastra\n}) {\n  const workflow = mastra.__getInternalWorkflow(\"__batch-scoring-traces\");\n  try {\n    const run = await workflow.createRunAsync();\n    await run.start({ inputData: { targets, scorerName } });\n  } catch (error) {\n    const mastraError = new MastraError(\n      {\n        category: \"SYSTEM\",\n        domain: \"SCORER\",\n        id: \"MASTRA_SCORER_FAILED_TO_RUN_TRACE_SCORING\",\n        details: {\n          scorerName,\n          targets: JSON.stringify(targets)\n        }\n      },\n      error\n    );\n    mastra.getLogger()?.trackException(mastraError);\n    mastra.getLogger()?.error(mastraError.toString());\n  }\n}\n\n// src/scores/scoreTraces/utils.ts\nfunction buildSpanTree(spans) {\n  const spanMap = /* @__PURE__ */ new Map();\n  const childrenMap = /* @__PURE__ */ new Map();\n  const rootSpans = [];\n  for (const span of spans) {\n    spanMap.set(span.spanId, span);\n  }\n  for (const span of spans) {\n    if (span.parentSpanId === null) {\n      rootSpans.push(span);\n    } else {\n      const siblings = childrenMap.get(span.parentSpanId) || [];\n      siblings.push(span);\n      childrenMap.set(span.parentSpanId, siblings);\n    }\n  }\n  for (const children of childrenMap.values()) {\n    children.sort((a, b) => new Date(a.startedAt).getTime() - new Date(b.startedAt).getTime());\n  }\n  rootSpans.sort((a, b) => new Date(a.startedAt).getTime() - new Date(b.startedAt).getTime());\n  return { spanMap, childrenMap, rootSpans };\n}\nfunction getChildrenOfType(spanTree, parentSpanId, spanType) {\n  const children = spanTree.childrenMap.get(parentSpanId) || [];\n  return children.filter((span) => span.spanType === spanType);\n}\nfunction normalizeMessageContent(content) {\n  if (typeof content === \"string\") {\n    return content;\n  }\n  const tempMessage = {\n    id: \"temp\",\n    role: \"user\",\n    parts: content.map((part) => ({ type: part.type, text: part.text }))\n  };\n  const converted = convertMessages(tempMessage).to(\"AIV4.UI\");\n  return converted[0]?.content || \"\";\n}\nfunction convertToUIMessage(message, createdAt) {\n  let messageInput;\n  if (typeof message.content === \"string\") {\n    messageInput = {\n      id: \"temp\",\n      role: message.role,\n      content: message.content\n    };\n  } else {\n    messageInput = {\n      id: \"temp\",\n      role: message.role,\n      parts: message.content.map((part) => ({ type: part.type, text: part.text }))\n    };\n  }\n  const converted = convertMessages(messageInput).to(\"AIV4.UI\");\n  const result = converted[0];\n  if (!result) {\n    throw new Error(\"Failed to convert message\");\n  }\n  return {\n    ...result,\n    id: \"\",\n    // Spans don't have message IDs\n    createdAt: new Date(createdAt)\n    // Use span timestamp\n  };\n}\nfunction extractInputMessages(agentSpan) {\n  const input = agentSpan.input;\n  if (typeof input === \"string\") {\n    return [\n      {\n        role: \"user\",\n        content: input,\n        createdAt: new Date(agentSpan.startedAt),\n        parts: [{ type: \"text\", text: input }],\n        experimental_attachments: []\n      }\n    ];\n  }\n  if (Array.isArray(input)) {\n    return input.map((msg) => convertToUIMessage(msg, agentSpan.startedAt));\n  }\n  if (input && typeof input === \"object\" && Array.isArray(input.messages)) {\n    return input.messages.map((msg) => convertToUIMessage(msg, agentSpan.startedAt));\n  }\n  return [];\n}\nfunction extractSystemMessages(llmSpan) {\n  return (llmSpan.input?.messages || []).filter((msg) => msg.role === \"system\").map((msg) => ({\n    role: \"system\",\n    content: normalizeMessageContent(msg.content)\n  }));\n}\nfunction extractRememberedMessages(llmSpan, currentInputContent) {\n  const messages = (llmSpan.input?.messages || []).filter((msg) => msg.role !== \"system\").filter((msg) => normalizeMessageContent(msg.content) !== currentInputContent);\n  return messages.map((msg) => convertToUIMessage(msg, llmSpan.startedAt));\n}\nfunction reconstructToolInvocations(spanTree, parentSpanId) {\n  const toolSpans = getChildrenOfType(spanTree, parentSpanId, \"tool_call\" /* TOOL_CALL */);\n  return toolSpans.map((toolSpan) => ({\n    state: \"result\",\n    toolName: toolSpan.attributes?.toolId,\n    args: toolSpan.input || {},\n    result: toolSpan.output || {}\n  }));\n}\nfunction createMessageParts(toolInvocations, textContent) {\n  const parts = [];\n  for (const toolInvocation of toolInvocations) {\n    parts.push({\n      type: \"tool-invocation\",\n      toolInvocation\n    });\n  }\n  if (textContent.trim()) {\n    parts.push({\n      type: \"text\",\n      text: textContent\n    });\n  }\n  return parts;\n}\nfunction validateTrace(trace) {\n  if (!trace) {\n    throw new Error(\"Trace is null or undefined\");\n  }\n  if (!trace.spans || !Array.isArray(trace.spans)) {\n    throw new Error(\"Trace must have a spans array\");\n  }\n  if (trace.spans.length === 0) {\n    throw new Error(\"Trace has no spans\");\n  }\n  const spanIds = new Set(trace.spans.map((span) => span.spanId));\n  for (const span of trace.spans) {\n    if (span.parentSpanId && !spanIds.has(span.parentSpanId)) {\n      throw new Error(`Span ${span.spanId} references non-existent parent ${span.parentSpanId}`);\n    }\n  }\n}\nfunction findPrimaryLLMSpan(spanTree, rootAgentSpan) {\n  const directLLMSpans = getChildrenOfType(spanTree, rootAgentSpan.spanId, \"model_generation\" /* MODEL_GENERATION */);\n  if (directLLMSpans.length > 0) {\n    return directLLMSpans[0];\n  }\n  throw new Error(\"No model generation span found in trace\");\n}\nfunction prepareTraceForTransformation(trace) {\n  validateTrace(trace);\n  const spanTree = buildSpanTree(trace.spans);\n  const rootAgentSpan = spanTree.rootSpans.find((span) => span.spanType === \"agent_run\");\n  if (!rootAgentSpan) {\n    throw new Error(\"No root agent_run span found in trace\");\n  }\n  return { spanTree, rootAgentSpan };\n}\nfunction transformTraceToScorerInputAndOutput(trace) {\n  const { spanTree, rootAgentSpan } = prepareTraceForTransformation(trace);\n  if (!rootAgentSpan.output) {\n    throw new Error(\"Root agent span has no output\");\n  }\n  const primaryLLMSpan = findPrimaryLLMSpan(spanTree, rootAgentSpan);\n  const inputMessages = extractInputMessages(rootAgentSpan);\n  const systemMessages = extractSystemMessages(primaryLLMSpan);\n  const currentInputContent = inputMessages[0]?.content || \"\";\n  const rememberedMessages = extractRememberedMessages(primaryLLMSpan, currentInputContent);\n  const input = {\n    // We do not keep track of the tool call ids in traces, so we need to cast to UIMessageWithMetadata\n    inputMessages,\n    rememberedMessages,\n    systemMessages,\n    taggedSystemMessages: {}\n    // Todo: Support tagged system messages\n  };\n  const toolInvocations = reconstructToolInvocations(spanTree, rootAgentSpan.spanId);\n  const responseText = rootAgentSpan.output.text || \"\";\n  const responseMessage = {\n    role: \"assistant\",\n    content: responseText,\n    createdAt: new Date(rootAgentSpan.endedAt || rootAgentSpan.startedAt),\n    // @ts-ignore\n    parts: createMessageParts(toolInvocations, responseText),\n    experimental_attachments: [],\n    // Tool invocations are being deprecated however we need to support it for now\n    toolInvocations\n  };\n  const output = [responseMessage];\n  return {\n    input,\n    output\n  };\n}\n\n// src/scores/scoreTraces/scoreTracesWorkflow.ts\nvar getTraceStep = createStep({\n  id: \"__process-trace-scoring\",\n  inputSchema: z.object({\n    targets: z.array(\n      z.object({\n        traceId: z.string(),\n        spanId: z.string().optional()\n      })\n    ),\n    scorerName: z.string()\n  }),\n  outputSchema: z.any(),\n  execute: async ({ inputData, tracingContext, mastra }) => {\n    const logger = mastra.getLogger();\n    if (!logger) {\n      console.warn(\n        \"[scoreTracesWorkflow] Logger not initialized: no debug or error logs will be recorded for scoring traces.\"\n      );\n    }\n    const storage = mastra.getStorage();\n    if (!storage) {\n      const mastraError = new MastraError({\n        id: \"MASTRA_STORAGE_NOT_FOUND_FOR_TRACE_SCORING\",\n        domain: \"STORAGE\" /* STORAGE */,\n        category: \"SYSTEM\" /* SYSTEM */,\n        text: \"Storage not found for trace scoring\",\n        details: {\n          scorerName: inputData.scorerName\n        }\n      });\n      logger?.error(mastraError.toString());\n      logger?.trackException(mastraError);\n      return;\n    }\n    let scorer;\n    try {\n      scorer = mastra.getScorerByName(inputData.scorerName);\n    } catch (error) {\n      const mastraError = new MastraError(\n        {\n          id: \"MASTRA_SCORER_NOT_FOUND_FOR_TRACE_SCORING\",\n          domain: \"SCORER\" /* SCORER */,\n          category: \"SYSTEM\" /* SYSTEM */,\n          text: `Scorer not found for trace scoring`,\n          details: {\n            scorerName: inputData.scorerName\n          }\n        },\n        error\n      );\n      logger?.error(mastraError.toString());\n      logger?.trackException(mastraError);\n      return;\n    }\n    await pMap(\n      inputData.targets,\n      async (target) => {\n        try {\n          await runScorerOnTarget({ storage, scorer, target, tracingContext });\n        } catch (error) {\n          const mastraError = new MastraError(\n            {\n              id: \"MASTRA_SCORER_FAILED_TO_RUN_SCORER_ON_TRACE\",\n              domain: \"SCORER\" /* SCORER */,\n              category: \"SYSTEM\" /* SYSTEM */,\n              details: {\n                scorerName: scorer.name,\n                spanId: target.spanId || \"\",\n                traceId: target.traceId\n              }\n            },\n            error\n          );\n          logger?.error(mastraError.toString());\n          logger?.trackException(mastraError);\n        }\n      },\n      { concurrency: 3 }\n    );\n  }\n});\nasync function runScorerOnTarget({\n  storage,\n  scorer,\n  target,\n  tracingContext\n}) {\n  const trace = await storage.getAITrace(target.traceId);\n  if (!trace) {\n    throw new Error(`Trace not found for scoring, traceId: ${target.traceId}`);\n  }\n  let span;\n  if (target.spanId) {\n    span = trace.spans.find((span2) => span2.spanId === target.spanId);\n  } else {\n    span = trace.spans.find((span2) => span2.parentSpanId === null);\n  }\n  if (!span) {\n    throw new Error(\n      `Span not found for scoring, traceId: ${target.traceId}, spanId: ${target.spanId ?? \"Not provided\"}`\n    );\n  }\n  const scorerRun = buildScorerRun({\n    scorerType: scorer.type === \"agent\" ? \"agent\" : void 0,\n    tracingContext,\n    trace,\n    targetSpan: span\n  });\n  const result = await scorer.run(scorerRun);\n  const scorerResult = {\n    ...result,\n    scorer: {\n      id: scorer.name,\n      name: scorer.name,\n      description: scorer.description\n    },\n    traceId: target.traceId,\n    spanId: target.spanId,\n    entityId: span.name,\n    entityType: span.spanType,\n    entity: { traceId: span.traceId, spanId: span.spanId },\n    source: \"TEST\",\n    scorerId: scorer.name\n  };\n  const savedScoreRecord = await validateAndSaveScore({ storage, scorerResult });\n  await attachScoreToSpan({ storage, span, scoreRecord: savedScoreRecord });\n}\nasync function validateAndSaveScore({ storage, scorerResult }) {\n  const payloadToSave = saveScorePayloadSchema.parse(scorerResult);\n  const result = await storage.saveScore(payloadToSave);\n  return result.score;\n}\nfunction buildScorerRun({\n  scorerType,\n  tracingContext,\n  trace,\n  targetSpan\n}) {\n  let runPayload;\n  if (scorerType === \"agent\") {\n    const { input, output } = transformTraceToScorerInputAndOutput(trace);\n    runPayload = {\n      input,\n      output\n    };\n  } else {\n    runPayload = { input: targetSpan.input, output: targetSpan.output };\n  }\n  runPayload.tracingContext = tracingContext;\n  return runPayload;\n}\nasync function attachScoreToSpan({\n  storage,\n  span,\n  scoreRecord\n}) {\n  const existingLinks = span.links || [];\n  const link = {\n    type: \"score\",\n    scoreId: scoreRecord.id,\n    scorerName: scoreRecord.scorer.name,\n    score: scoreRecord.score,\n    createdAt: scoreRecord.createdAt\n  };\n  await storage.updateAISpan({\n    spanId: span.spanId,\n    traceId: span.traceId,\n    updates: { links: [...existingLinks, link] }\n  });\n}\nvar scoreTracesWorkflow = createWorkflow({\n  id: \"__batch-scoring-traces\",\n  inputSchema: z.object({\n    targets: z.array(\n      z.object({\n        traceId: z.string(),\n        spanId: z.string().optional()\n      })\n    ),\n    scorerName: z.string()\n  }),\n  outputSchema: z.any(),\n  steps: [getTraceStep],\n  options: {\n    tracingPolicy: {\n      internal: 15 /* ALL */\n    }\n  }\n});\nscoreTracesWorkflow.then(getTraceStep).commit();\n\nexport { scoreTraces, scoreTracesWorkflow };\n//# sourceMappingURL=index.js.map\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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","x_google_ignoreList":[0]}