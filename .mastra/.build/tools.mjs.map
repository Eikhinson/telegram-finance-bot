{"version":3,"file":"tools.mjs","sources":["../../node_modules/@mastra/core/dist/chunk-WM4RO23J.js"],"sourcesContent":["// src/tools/validation.ts\nfunction validateToolInput(schema, input, toolId) {\n  if (!schema || !(\"safeParse\" in schema)) {\n    return { data: input };\n  }\n  const validationAttempts = [];\n  const directValidation = schema.safeParse(input);\n  validationAttempts.push({\n    result: directValidation,\n    data: input,\n    structure: \"direct\"\n  });\n  if (directValidation.success) {\n    return { data: input };\n  }\n  if (input && typeof input === \"object\" && \"context\" in input) {\n    const contextData = input.context;\n    const contextValidation = schema.safeParse(contextData);\n    validationAttempts.push({\n      result: contextValidation,\n      data: contextData,\n      structure: \"context\"\n    });\n    if (contextValidation.success) {\n      return { data: { ...input, context: contextValidation.data } };\n    }\n    if (contextData && typeof contextData === \"object\" && \"inputData\" in contextData) {\n      const inputDataValue = contextData.inputData;\n      const inputDataValidation = schema.safeParse(inputDataValue);\n      validationAttempts.push({\n        result: inputDataValidation,\n        data: inputDataValue,\n        structure: \"inputData\"\n      });\n      if (inputDataValidation.success) {\n        const contextKeys = Object.keys(contextData);\n        if (contextKeys.length === 1 && contextKeys[0] === \"inputData\") {\n          return { data: { ...input, context: { inputData: inputDataValidation.data } } };\n        } else {\n          return { data: inputDataValidation.data };\n        }\n      }\n    }\n  }\n  let bestAttempt = validationAttempts[0];\n  for (const attempt of validationAttempts) {\n    if (!attempt.result.success && attempt.result.error.issues.length > 0) {\n      bestAttempt = attempt;\n    }\n  }\n  if (bestAttempt && !bestAttempt.result.success) {\n    const errorMessages = bestAttempt.result.error.issues.map((e) => `- ${e.path?.join(\".\") || \"root\"}: ${e.message}`).join(\"\\n\");\n    const error = {\n      error: true,\n      message: `Tool validation failed${toolId ? ` for ${toolId}` : \"\"}. Please fix the following errors and try again:\n${errorMessages}\n\nProvided arguments: ${JSON.stringify(bestAttempt.data, null, 2)}`,\n      validationErrors: bestAttempt.result.error.format()\n    };\n    return { data: input, error };\n  }\n  return { data: input };\n}\n\n// src/tools/tool.ts\nvar Tool = class {\n  /** Unique identifier for the tool */\n  id;\n  /** Description of what the tool does */\n  description;\n  /** Schema for validating input parameters */\n  inputSchema;\n  /** Schema for validating output structure */\n  outputSchema;\n  /** Schema for suspend operation data */\n  suspendSchema;\n  /** Schema for resume operation data */\n  resumeSchema;\n  /**\n   * Function that performs the tool's action\n   * @param context - Execution context with validated input\n   * @param options - Invocation options including suspend/resume data\n   * @returns Promise resolving to tool output\n   */\n  execute;\n  /** Parent Mastra instance for accessing shared resources */\n  mastra;\n  /**\n   * Whether the tool requires explicit user approval before execution\n   * @example\n   * ```typescript\n   * // For destructive operations\n   * requireApproval: true\n   * ```\n   */\n  requireApproval;\n  /**\n   * Creates a new Tool instance with input validation wrapper.\n   *\n   * @param opts - Tool configuration and execute function\n   * @example\n   * ```typescript\n   * const tool = new Tool({\n   *   id: 'my-tool',\n   *   description: 'Does something useful',\n   *   inputSchema: z.object({ name: z.string() }),\n   *   execute: async ({ context }) => ({ greeting: `Hello ${context.name}` })\n   * });\n   * ```\n   */\n  constructor(opts) {\n    this.id = opts.id;\n    this.description = opts.description;\n    this.inputSchema = opts.inputSchema;\n    this.outputSchema = opts.outputSchema;\n    this.suspendSchema = opts.suspendSchema;\n    this.resumeSchema = opts.resumeSchema;\n    this.mastra = opts.mastra;\n    this.requireApproval = opts.requireApproval || false;\n    if (opts.execute) {\n      const originalExecute = opts.execute;\n      this.execute = async (context, options) => {\n        const { resumeData, suspend } = options ?? {};\n        const { data, error } = validateToolInput(this.inputSchema, context, this.id);\n        if (error) {\n          return error;\n        }\n        return originalExecute({ ...data, suspend, resumeData }, options);\n      };\n    }\n  }\n};\nfunction createTool(opts) {\n  return new Tool(opts);\n}\n\n// src/tools/toolchecks.ts\nfunction isVercelTool(tool) {\n  return !!(tool && !(tool instanceof Tool) && \"parameters\" in tool);\n}\n\nexport { Tool, createTool, isVercelTool, validateToolInput };\n//# sourceMappingURL=chunk-WM4RO23J.js.map\n//# sourceMappingURL=chunk-WM4RO23J.js.map"],"names":[],"mappings":"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","x_google_ignoreList":[0]}