{"version":3,"file":"hono-body-limit.mjs","sources":["../../node_modules/hono/dist/middleware/body-limit/index.js"],"sourcesContent":["// src/middleware/body-limit/index.ts\nimport { HTTPException } from \"../../http-exception.js\";\nvar ERROR_MESSAGE = \"Payload Too Large\";\nvar BodyLimitError = class extends Error {\n  constructor(message) {\n    super(message);\n    this.name = \"BodyLimitError\";\n  }\n};\nvar bodyLimit = (options) => {\n  const onError = options.onError || (() => {\n    const res = new Response(ERROR_MESSAGE, {\n      status: 413\n    });\n    throw new HTTPException(413, { res });\n  });\n  const maxSize = options.maxSize;\n  return async function bodyLimit2(c, next) {\n    if (!c.req.raw.body) {\n      return next();\n    }\n    const hasTransferEncoding = c.req.raw.headers.has(\"transfer-encoding\");\n    const hasContentLength = c.req.raw.headers.has(\"content-length\");\n    if (hasTransferEncoding && hasContentLength) {\n    }\n    if (hasContentLength && !hasTransferEncoding) {\n      const contentLength = parseInt(c.req.raw.headers.get(\"content-length\") || \"0\", 10);\n      return contentLength > maxSize ? onError(c) : next();\n    }\n    let size = 0;\n    const rawReader = c.req.raw.body.getReader();\n    const reader = new ReadableStream({\n      async start(controller) {\n        try {\n          for (; ; ) {\n            const { done, value } = await rawReader.read();\n            if (done) {\n              break;\n            }\n            size += value.length;\n            if (size > maxSize) {\n              controller.error(new BodyLimitError(ERROR_MESSAGE));\n              break;\n            }\n            controller.enqueue(value);\n          }\n        } finally {\n          controller.close();\n        }\n      }\n    });\n    const requestInit = { body: reader, duplex: \"half\" };\n    c.req.raw = new Request(c.req.raw, requestInit);\n    await next();\n    if (c.error instanceof BodyLimitError) {\n      c.res = await onError(c);\n    }\n  };\n};\nexport {\n  bodyLimit\n};\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}