{"version":3,"file":"html.mjs","sources":["../../node_modules/hono/dist/utils/html.js"],"sourcesContent":["// src/utils/html.ts\nvar HtmlEscapedCallbackPhase = {\n  Stringify: 1,\n  BeforeStream: 2,\n  Stream: 3\n};\nvar raw = (value, callbacks) => {\n  const escapedString = new String(value);\n  escapedString.isEscaped = true;\n  escapedString.callbacks = callbacks;\n  return escapedString;\n};\nvar escapeRe = /[&<>'\"]/;\nvar stringBufferToString = async (buffer, callbacks) => {\n  let str = \"\";\n  callbacks ||= [];\n  const resolvedBuffer = await Promise.all(buffer);\n  for (let i = resolvedBuffer.length - 1; ; i--) {\n    str += resolvedBuffer[i];\n    i--;\n    if (i < 0) {\n      break;\n    }\n    let r = resolvedBuffer[i];\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    const isEscaped = r.isEscaped;\n    r = await (typeof r === \"object\" ? r.toString() : r);\n    if (typeof r === \"object\") {\n      callbacks.push(...r.callbacks || []);\n    }\n    if (r.isEscaped ?? isEscaped) {\n      str += r;\n    } else {\n      const buf = [str];\n      escapeToBuffer(r, buf);\n      str = buf[0];\n    }\n  }\n  return raw(str, callbacks);\n};\nvar escapeToBuffer = (str, buffer) => {\n  const match = str.search(escapeRe);\n  if (match === -1) {\n    buffer[0] += str;\n    return;\n  }\n  let escape;\n  let index;\n  let lastIndex = 0;\n  for (index = match; index < str.length; index++) {\n    switch (str.charCodeAt(index)) {\n      case 34:\n        escape = \"&quot;\";\n        break;\n      case 39:\n        escape = \"&#39;\";\n        break;\n      case 38:\n        escape = \"&amp;\";\n        break;\n      case 60:\n        escape = \"&lt;\";\n        break;\n      case 62:\n        escape = \"&gt;\";\n        break;\n      default:\n        continue;\n    }\n    buffer[0] += str.substring(lastIndex, index) + escape;\n    lastIndex = index + 1;\n  }\n  buffer[0] += str.substring(lastIndex, index);\n};\nvar resolveCallbackSync = (str) => {\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return str;\n  }\n  const buffer = [str];\n  const context = {};\n  callbacks.forEach((c) => c({ phase: HtmlEscapedCallbackPhase.Stringify, buffer, context }));\n  return buffer[0];\n};\nvar resolveCallback = async (str, phase, preserveCallbacks, context, buffer) => {\n  if (typeof str === \"object\" && !(str instanceof String)) {\n    if (!(str instanceof Promise)) {\n      str = str.toString();\n    }\n    if (str instanceof Promise) {\n      str = await str;\n    }\n  }\n  const callbacks = str.callbacks;\n  if (!callbacks?.length) {\n    return Promise.resolve(str);\n  }\n  if (buffer) {\n    buffer[0] += str;\n  } else {\n    buffer = [str];\n  }\n  const resStr = Promise.all(callbacks.map((c) => c({ phase, buffer, context }))).then(\n    (res) => Promise.all(\n      res.filter(Boolean).map((str2) => resolveCallback(str2, phase, false, context, buffer))\n    ).then(() => buffer[0])\n  );\n  if (preserveCallbacks) {\n    return raw(await resStr, callbacks);\n  } else {\n    return resStr;\n  }\n};\nexport {\n  HtmlEscapedCallbackPhase,\n  escapeToBuffer,\n  raw,\n  resolveCallback,\n  resolveCallbackSync,\n  stringBufferToString\n};\n"],"names":[],"mappings":"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","x_google_ignoreList":[0]}